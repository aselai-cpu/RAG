<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="796px" preserveAspectRatio="none" style="width:1016px;height:796px;" version="1.1" viewBox="0 0 1016 796" width="1016px" zoomAndPan="magnify"><defs><filter height="300%" id="f1gh76d5dv5yk0" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="327" x="337" y="17.4023">Domain-Driven Design - Entity Model</text><!--MD5=[cc167570a590d8dbd4742108b55f98b1]
cluster Domain Layer--><polygon fill="#FFFFFF" filter="url(#f1gh76d5dv5yk0)" points="16,62.4592,121,62.4592,128,84.9475,827,84.9475,827,789.5192,16,789.5192,16,62.4592" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="16" x2="128" y1="84.9475" y2="84.9475"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="99" x="20" y="77.9944">Domain Layer</text><!--MD5=[114f4823940f317c08f5bedd633c9afd]
cluster Entities--><polygon fill="#FFFFFF" filter="url(#f1gh76d5dv5yk0)" points="152,334.2392,213,334.2392,220,356.7275,643,356.7275,643,765.5192,152,765.5192,152,334.2392" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="152" x2="220" y1="356.7275" y2="356.7275"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="55" x="156" y="349.7744">Entities</text><!--MD5=[34bed16515701fd83173b55a780e829a]
cluster Repository Interfaces--><polygon fill="#FFFFFF" filter="url(#f1gh76d5dv5yk0)" points="40,105.4592,200,105.4592,207,127.9475,803,127.9475,803,285.2392,40,285.2392,40,105.4592" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="40" x2="207" y1="127.9475" y2="127.9475"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="154" x="44" y="120.9944">Repository Interfaces</text><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="166" x="342.5" y="143.4827">«Anti-Corruption Layer»</text><!--MD5=[59b530d44ae785dc18db921986a9c15c]
class Document--><rect codeLine="7" fill="#FEFECE" filter="url(#f1gh76d5dv5yk0)" height="164.5957" id="Document" style="stroke:#A80036;stroke-width:1.5;" width="152" x="168" y="369.2392"/><ellipse cx="210.9" cy="385.2392" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M213.3731,391.3823 Q212.7921,391.6811 212.1529,391.8305 Q211.5138,391.9799 210.8082,391.9799 Q208.3014,391.9799 206.9815,390.3281 Q205.6617,388.6762 205.6617,385.5551 Q205.6617,382.4257 206.9815,380.7739 Q208.3014,379.122 210.8082,379.122 Q211.5138,379.122 212.1612,379.2714 Q212.8087,379.4209 213.3731,379.7197 L213.3731,382.4423 Q212.7423,381.8613 212.1488,381.5915 Q211.5553,381.3217 210.9244,381.3217 Q209.5797,381.3217 208.8949,382.3884 Q208.2101,383.455 208.2101,385.5551 Q208.2101,387.6469 208.8949,388.7136 Q209.5797,389.7802 210.9244,389.7802 Q211.5553,389.7802 212.1488,389.5105 Q212.7423,389.2407 213.3731,388.6596 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="58" x="231.1" y="389.7744">Document</text><line style="stroke:#A80036;stroke-width:1.5;" x1="169" x2="319" y1="401.2392" y2="401.2392"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="176" y="409.2392"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="31" x="188" y="415.874">id: str</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="176" y="422.1943"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="62" x="188" y="428.8291">content: str</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="176" y="435.1494"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="87" x="188" y="441.7841">source_type: str</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="176" y="448.1045"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="126" x="188" y="454.7392">file_name: Optional[str]</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="176" y="461.0595"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="75" x="188" y="467.6943">metadata: dict</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="176" y="474.0146"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="108" x="188" y="480.6494">created_at: datetime</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="176" y="486.9697"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="90" x="188" y="493.6045">chunk_count: int</text><line style="stroke:#A80036;stroke-width:1.0;" x1="169" x2="319" y1="499.9248" y2="499.9248"/><ellipse cx="179" cy="510.9248" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="125" x="188" y="514.5595">get_display_name(): str</text><ellipse cx="179" cy="523.8798" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="71" x="188" y="527.5146">to_dict(): dict</text><!--MD5=[bea5b0d46523efab5ea1c1d339f396f0]
class Message--><rect codeLine="20" fill="#FEFECE" filter="url(#f1gh76d5dv5yk0)" height="138.6855" id="Message" style="stroke:#A80036;stroke-width:1.5;" width="134" x="475" y="610.8292"/><ellipse cx="513.4" cy="626.8292" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M515.8731,632.9723 Q515.2921,633.2711 514.6529,633.4205 Q514.0138,633.5699 513.3082,633.5699 Q510.8014,633.5699 509.4815,631.9181 Q508.1617,630.2662 508.1617,627.1451 Q508.1617,624.0157 509.4815,622.3639 Q510.8014,620.712 513.3082,620.712 Q514.0138,620.712 514.6612,620.8614 Q515.3087,621.0109 515.8731,621.3097 L515.8731,624.0323 Q515.2423,623.4513 514.6488,623.1815 Q514.0553,622.9117 513.4244,622.9117 Q512.0797,622.9117 511.3949,623.9784 Q510.7101,625.045 510.7101,627.1451 Q510.7101,629.2369 511.3949,630.3036 Q512.0797,631.3702 513.4244,631.3702 Q514.0553,631.3702 514.6488,631.1005 Q515.2423,630.8307 515.8731,630.2496 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="50" x="532.6" y="631.3644">Message</text><line style="stroke:#A80036;stroke-width:1.5;" x1="476" x2="608" y1="642.8292" y2="642.8292"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="483" y="650.8292"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="31" x="495" y="657.464">id: str</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="483" y="663.7843"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="42" x="495" y="670.4191">role: str</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="483" y="676.7394"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="62" x="495" y="683.3741">content: str</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="483" y="689.6945"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="108" x="495" y="696.3292">created_at: datetime</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="483" y="702.6495"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="91" x="495" y="709.2843">sources: List[str]</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="483" y="715.6046"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="75" x="495" y="722.2394">metadata: dict</text><line style="stroke:#A80036;stroke-width:1.0;" x1="476" x2="608" y1="728.5597" y2="728.5597"/><ellipse cx="486" cy="739.5597" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="71" x="495" y="743.1945">to_dict(): dict</text><!--MD5=[459e69cb7d6992406639a393570154fc]
class ChatSession--><rect codeLine="31" fill="#FEFECE" filter="url(#f1gh76d5dv5yk0)" height="151.6406" id="ChatSession" style="stroke:#A80036;stroke-width:1.5;" width="271" x="355.5" y="375.7192"/><ellipse cx="452.75" cy="391.7192" fill="#ADD1B2" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M455.2231,397.8623 Q454.6421,398.1611 454.0029,398.3105 Q453.3638,398.4599 452.6582,398.4599 Q450.1514,398.4599 448.8315,396.8081 Q447.5117,395.1562 447.5117,392.0351 Q447.5117,388.9057 448.8315,387.2539 Q450.1514,385.602 452.6582,385.602 Q453.3638,385.602 454.0112,385.7514 Q454.6587,385.9009 455.2231,386.1997 L455.2231,388.9223 Q454.5923,388.3413 453.9988,388.0715 Q453.4053,387.8017 452.7744,387.8017 Q451.4297,387.8017 450.7449,388.8684 Q450.0601,389.935 450.0601,392.0351 Q450.0601,394.1269 450.7449,395.1936 Q451.4297,396.2602 452.7744,396.2602 Q453.4053,396.2602 453.9988,395.9905 Q454.5923,395.7207 455.2231,395.1396 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="68" x="473.25" y="396.2544">ChatSession</text><line style="stroke:#A80036;stroke-width:1.5;" x1="356.5" x2="625.5" y1="407.7192" y2="407.7192"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="363.5" y="415.7192"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="31" x="375.5" y="422.354">id: str</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="363.5" y="428.6743"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="132" x="375.5" y="435.3091">messages: List[Message]</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="363.5" y="441.6294"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="108" x="375.5" y="448.2641">created_at: datetime</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="363.5" y="454.5845"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="112" x="375.5" y="461.2192">updated_at: datetime</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="363.5" y="467.5395"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="75" x="375.5" y="474.1743">metadata: dict</text><line style="stroke:#A80036;stroke-width:1.0;" x1="356.5" x2="625.5" y1="480.4946" y2="480.4946"/><ellipse cx="366.5" cy="491.4946" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="209" x="375.5" y="495.1294">add_message(message: Message): void</text><ellipse cx="366.5" cy="504.4497" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="245" x="375.5" y="508.0845">get_history(limit: Optional[int]): List[Message]</text><ellipse cx="366.5" cy="517.4048" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="71" x="375.5" y="521.0395">to_dict(): dict</text><!--MD5=[b58dc8a32998ac0d9491d06d85c5b72c]
class IDocumentRepository--><rect codeLine="45" fill="#FEFECE" filter="url(#f1gh76d5dv5yk0)" height="112.7754" id="IDocumentRepository" style="stroke:#A80036;stroke-width:1.5;" width="376" x="56" y="156.4592"/><ellipse cx="178.75" cy="172.4592" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M175.1777,168.7244 L175.1777,166.5662 L182.5571,166.5662 L182.5571,168.7244 L180.0918,168.7244 L180.0918,176.801 L182.5571,176.801 L182.5571,178.9592 L175.1777,178.9592 L175.1777,176.801 L177.6431,176.801 L177.6431,168.7244 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="122" x="199.25" y="176.9944">IDocumentRepository</text><line style="stroke:#A80036;stroke-width:1.5;" x1="57" x2="431" y1="188.4592" y2="188.4592"/><line style="stroke:#A80036;stroke-width:1.5;" x1="57" x2="431" y1="196.4592" y2="196.4592"/><ellipse cx="67" cy="207.4592" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="176" x="76" y="211.094">save(document: Document): void</text><ellipse cx="67" cy="220.4143" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="206" x="76" y="224.0491">get_by_id(id: str): Optional[Document]</text><ellipse cx="67" cy="233.3694" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="131" x="76" y="237.0041">get_all(): List[Document]</text><ellipse cx="67" cy="246.3245" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="101" x="76" y="249.9592">delete(id: str): bool</text><ellipse cx="67" cy="259.2795" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="350" x="76" y="262.9143">search_similar(query: str, top_k: int): List[Tuple[Document, float]]</text><!--MD5=[977180da12912c74a6d231ff4c6b2ffa]
class IChatRepository--><rect codeLine="53" fill="#FEFECE" filter="url(#f1gh76d5dv5yk0)" height="99.8203" id="IChatRepository" style="stroke:#A80036;stroke-width:1.5;" width="319" x="467.5" y="162.9392"/><ellipse cx="577.75" cy="178.9392" fill="#B4A7E5" rx="11" ry="11" style="stroke:#A80036;stroke-width:1.0;"/><path d="M574.1777,175.2044 L574.1777,173.0462 L581.5571,173.0462 L581.5571,175.2044 L579.0918,175.2044 L579.0918,183.281 L581.5571,183.281 L581.5571,185.4392 L574.1777,185.4392 L574.1777,183.281 L576.6431,183.281 L576.6431,175.2044 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="90" x="598.25" y="183.4744">IChatRepository</text><line style="stroke:#A80036;stroke-width:1.5;" x1="468.5" x2="785.5" y1="194.9392" y2="194.9392"/><line style="stroke:#A80036;stroke-width:1.5;" x1="468.5" x2="785.5" y1="202.9392" y2="202.9392"/><ellipse cx="478.5" cy="213.9392" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="221" x="487.5" y="217.574">save_session(session: ChatSession): void</text><ellipse cx="478.5" cy="226.8943" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="229" x="487.5" y="230.5291">get_session(id: str): Optional[ChatSession]</text><ellipse cx="478.5" cy="239.8494" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="195" x="487.5" y="243.4841">get_all_sessions(): List[ChatSession]</text><ellipse cx="478.5" cy="252.8045" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="293" x="487.5" y="256.4392">add_message(session_id: str, message: Message): void</text><path d="M843,184.8892 L843,240.8209 L1007,240.8209 L1007,194.8892 L997,184.8892 L843,184.8892 " fill="#FBFB77" filter="url(#f1gh76d5dv5yk0)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M997,184.8892 L997,194.8892 L1007,194.8892 L997,184.8892 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="849" y="202.4576">Anti-Corruption Layer:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136" x="849" y="217.7681">Protects domain from</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="849" y="233.0787">infrastructure changes</text><!--MD5=[2d11a37f4899941ac5ffe64529a493f7]
reverse link ChatSession to Message--><path codeLine="62" d="M511.06,541.6892 C516.2,564.5192 521.64,588.7192 526.51,610.3492 " fill="none" id="ChatSession-backto-Message" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="508.24,529.1692,505.6561,535.9015,510.8767,540.876,513.4606,534.1437,508.24,529.1692" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="54" x="520.55" y="577.3976">contains</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="501.1001" y="547.9833">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="34" x="489.1595" y="599.9597">many</text><!--MD5=[c297a286e5b468677e5c16f33c84b7af]
link IDocumentRepository to Document--><path codeLine="63" d="M244,269.6392 C244,297.4492 244,331.7092 244,362.9192 " fill="none" id="IDocumentRepository-to-Document" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#A80036" points="244,367.5992,248,358.5992,244,362.5992,240,358.5992,244,367.5992" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="29" x="245" y="314.8076">uses</text><!--MD5=[7e07a2de29670452915e49a6b77bcee7]
link IChatRepository to ChatSession--><path codeLine="64" d="M598.66,263.1792 C580.92,294.0392 557.65,334.5292 537.29,369.9792 " fill="none" id="IChatRepository-to-ChatSession" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#A80036" points="534.8,374.3092,542.7506,368.4965,537.2899,369.9733,535.8131,364.5126,534.8,374.3092" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="29" x="576.18" y="314.8076">uses</text><!--MD5=[de2d92af9358366fe2d8c1240b2ad9f9]
link IChatRepository to Message--><path codeLine="65" d="M640.15,263.1792 C654.88,327.2092 673.11,441.6592 644,533.8292 C636.01,559.1392 621.85,583.8692 606.58,605.5392 " fill="none" id="IChatRepository-to-Message" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><polygon fill="#A80036" points="603.78,609.4592,612.2594,604.4493,606.6808,605.3867,605.7434,599.808,603.78,609.4592" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="29" x="660.47" y="456.6076">uses</text><!--MD5=[e4c81109d0b835adbca02f0aca35f65e]
link IDocumentRepository to GMN14--><path d="M295.62,156.3392 C337.38,115.0892 400.13,62.5292 467.5,39.4592 C500.93,28.0192 752.36,27.1992 785.5,39.4592 C851.81,63.9892 894.6,142.0492 913.62,184.5792 " fill="none" id="IDocumentRepository-GMN14" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><!--MD5=[b8a868ff175abb33b42731fa87082d35]
@startuml DDD Entity Model

title Domain-Driven Design - Entity Model

package "Domain Layer" {

    package "Entities" {
        class Document {
            -id: str
            -content: str
            -source_type: str
            -file_name: Optional[str]
            -metadata: dict
            -created_at: datetime
            -chunk_count: int
            - -
            +get_display_name(): str
            +to_dict(): dict
        }

        class Message {
            -id: str
            -role: str
            -content: str
            -created_at: datetime
            -sources: List[str]
            -metadata: dict
            - -
            +to_dict(): dict
        }

        class ChatSession {
            -id: str
            -messages: List[Message]
            -created_at: datetime
            -updated_at: datetime
            -metadata: dict
            - -
            +add_message(message: Message): void
            +get_history(limit: Optional[int]): List[Message]
            +to_dict(): dict
        }
    }

    package "Repository Interfaces" <<Anti-Corruption Layer>> {
        interface IDocumentRepository {
            +save(document: Document): void
            +get_by_id(id: str): Optional[Document]
            +get_all(): List[Document]
            +delete(id: str): bool
            +search_similar(query: str, top_k: int): List[Tuple[Document, float]]
        }

        interface IChatRepository {
            +save_session(session: ChatSession): void
            +get_session(id: str): Optional[ChatSession]
            +get_all_sessions(): List[ChatSession]
            +add_message(session_id: str, message: Message): void
        }
    }
}

ChatSession "1" *- - "many" Message : contains
IDocumentRepository ..> Document : uses
IChatRepository ..> ChatSession : uses
IChatRepository ..> Message : uses

note right of IDocumentRepository
    Anti-Corruption Layer:
    Protects domain from
    infrastructure changes
end note

@enduml

PlantUML version 1.2021.00(Sun Jan 10 18:25:05 SGT 2021)
(MIT source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: SG
--></g></svg>