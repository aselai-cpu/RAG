<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="3526px" preserveAspectRatio="none" style="width:2665px;height:3526px;" version="1.1" viewBox="0 0 2665 3526" width="2665px" zoomAndPan="magnify"><defs><filter height="300%" id="flnns3syfb0ss" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="635" x="1011.5" y="29.4023">Graph RAG Query Flow - Hybrid Context Building (Vector DB + Graph DB)</text><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="3269.2285" style="stroke:#A80036;stroke-width:1.0;" width="10" x="240.5" y="154.998"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="3195.2969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="477.5" y="184.3086"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="2967.4336" style="stroke:#A80036;stroke-width:1.0;" width="10" x="752.5" y="298.2402"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="259.7266" style="stroke:#A80036;stroke-width:1.0;" width="10" x="757.5" y="2604.2207"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="2152.7383" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1065.5" y="370.8613"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="257.1738" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1339.5" y="454.793"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="87.9316" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1339.5" y="2318.1152"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="113.9316" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1567.5" y="484.1035"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="29.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1567.5" y="2347.4258"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="146.5527" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1729.5" y="839.209"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="87.9316" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1896" y="1155.3145"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="87.9316" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1896" y="1327.1777"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="87.9316" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1896" y="1483.7305"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="103.2422" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1896" y="1655.5938"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="87.9316" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1896" y="1867.0781"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="87.9316" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1896" y="1984.3203"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="29.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2207" y="1184.625"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="29.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2207" y="1356.4883"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="29.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2207" y="1513.041"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="29.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2207" y="1700.2148"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="29.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2207" y="1896.3887"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="29.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2207" y="2013.6309"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="87.9316" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2323.5" y="868.5195"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="215.1738" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2323.5" y="2985.8789"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="185.8633" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2585.5" y="3015.1895"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="251.7949" style="stroke:#000000;stroke-width:2.0;" width="1296.5" x="971.5" y="1828.457"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="163.8633" style="stroke:#000000;stroke-width:2.0;" width="2638" x="10" y="3030.1895"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="38" x2="38" y1="123.6875" y2="3442.2266"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="245" x2="245" y1="123.6875" y2="3442.2266"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="482.5" x2="482.5" y1="123.6875" y2="3442.2266"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="757" x2="757" y1="123.6875" y2="3442.2266"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1070.5" x2="1070.5" y1="123.6875" y2="3442.2266"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1344.5" x2="1344.5" y1="123.6875" y2="3442.2266"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1572.5" x2="1572.5" y1="123.6875" y2="3442.2266"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1734.5" x2="1734.5" y1="123.6875" y2="3442.2266"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1900.5" x2="1900.5" y1="123.6875" y2="3442.2266"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="2212" x2="2212" y1="123.6875" y2="3442.2266"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="2328" x2="2328" y1="123.6875" y2="3442.2266"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="2590" x2="2590" y1="123.6875" y2="3442.2266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="20" y="120.7344">User</text><ellipse cx="38.5" cy="50.1992" fill="#FEFECE" filter="url(#flnns3syfb0ss)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M38.5,58.1992 L38.5,85.1992 M25.5,66.1992 L51.5,66.1992 M38.5,85.1992 L25.5,100.1992 M38.5,85.1992 L51.5,100.1992 " fill="none" filter="url(#flnns3syfb0ss)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="20" y="3454.7617">User</text><ellipse cx="38.5" cy="3467.7148" fill="#FEFECE" filter="url(#flnns3syfb0ss)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M38.5,3475.7148 L38.5,3502.7148 M25.5,3483.7148 L51.5,3483.7148 M38.5,3502.7148 L25.5,3517.7148 M38.5,3502.7148 L51.5,3517.7148 " fill="none" filter="url(#flnns3syfb0ss)" style="stroke:#A80036;stroke-width:2.0;"/><rect fill="#FEFECE" filter="url(#flnns3syfb0ss)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="93" x="197" y="88.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="204" y="108.7344">Streamlit UI</text><rect fill="#FEFECE" filter="url(#flnns3syfb0ss)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="93" x="197" y="3441.2266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="204" y="3461.7617">Streamlit UI</text><rect fill="#FEFECE" filter="url(#flnns3syfb0ss)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="98" x="431.5" y="88.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="438.5" y="108.7344">Chat Service</text><rect fill="#FEFECE" filter="url(#flnns3syfb0ss)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="98" x="431.5" y="3441.2266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="438.5" y="3461.7617">Chat Service</text><rect fill="#FEFECE" filter="url(#flnns3syfb0ss)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="95" x="708" y="88.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="715" y="108.7344">RAG Service</text><rect fill="#FEFECE" filter="url(#flnns3syfb0ss)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="95" x="708" y="3441.2266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="715" y="3461.7617">RAG Service</text><rect fill="#FEFECE" filter="url(#flnns3syfb0ss)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="174" x="981.5" y="88.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="160" x="988.5" y="108.7344">Hybrid Retrieval Service</text><rect fill="#FEFECE" filter="url(#flnns3syfb0ss)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="174" x="981.5" y="3441.2266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="160" x="988.5" y="3461.7617">Hybrid Retrieval Service</text><rect fill="#FEFECE" filter="url(#flnns3syfb0ss)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="212" x="1236.5" y="88.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="198" x="1243.5" y="108.7344">ChromaDocumentRepository</text><rect fill="#FEFECE" filter="url(#flnns3syfb0ss)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="212" x="1236.5" y="3441.2266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="198" x="1243.5" y="3461.7617">ChromaDocumentRepository</text><rect fill="#FEFECE" filter="url(#flnns3syfb0ss)" height="46.9766" style="stroke:#A80036;stroke-width:1.5;" width="90" x="1525.5" y="71.7109"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73" x="1534" y="92.2461">ChromaDB</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76" x="1532.5" y="108.7344">(Vector DB)</text><rect fill="#FEFECE" filter="url(#flnns3syfb0ss)" height="46.9766" style="stroke:#A80036;stroke-width:1.5;" width="90" x="1525.5" y="3441.2266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73" x="1534" y="3461.7617">ChromaDB</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76" x="1532.5" y="3478.25">(Vector DB)</text><rect fill="#FEFECE" filter="url(#flnns3syfb0ss)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="178" x="1643.5" y="88.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="164" x="1650.5" y="108.7344">Entity Extraction Service</text><rect fill="#FEFECE" filter="url(#flnns3syfb0ss)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="178" x="1643.5" y="3441.2266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="164" x="1650.5" y="3461.7617">Entity Extraction Service</text><rect fill="#FEFECE" filter="url(#flnns3syfb0ss)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="127" x="1835.5" y="88.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="113" x="1842.5" y="108.7344">Neo4jRepository</text><rect fill="#FEFECE" filter="url(#flnns3syfb0ss)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="127" x="1835.5" y="3441.2266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="113" x="1842.5" y="3461.7617">Neo4jRepository</text><rect fill="#FEFECE" filter="url(#flnns3syfb0ss)" height="46.9766" style="stroke:#A80036;stroke-width:1.5;" width="88" x="2166" y="71.7109"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="2190" y="92.2461">Neo4j</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74" x="2173" y="108.7344">(Graph DB)</text><rect fill="#FEFECE" filter="url(#flnns3syfb0ss)" height="46.9766" style="stroke:#A80036;stroke-width:1.5;" width="88" x="2166" y="3441.2266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="2190" y="3461.7617">Neo4j</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74" x="2173" y="3478.25">(Graph DB)</text><rect fill="#FEFECE" filter="url(#flnns3syfb0ss)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="117" x="2268" y="88.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="103" x="2275" y="108.7344">OpenAI Service</text><rect fill="#FEFECE" filter="url(#flnns3syfb0ss)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="117" x="2268" y="3441.2266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="103" x="2275" y="3461.7617">OpenAI Service</text><rect fill="#FEFECE" filter="url(#flnns3syfb0ss)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="91" x="2543" y="88.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77" x="2550" y="108.7344">OpenAI API</text><rect fill="#FEFECE" filter="url(#flnns3syfb0ss)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="91" x="2543" y="3441.2266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77" x="2550" y="3461.7617">OpenAI API</text><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="3269.2285" style="stroke:#A80036;stroke-width:1.0;" width="10" x="240.5" y="154.998"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="3195.2969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="477.5" y="184.3086"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="2967.4336" style="stroke:#A80036;stroke-width:1.0;" width="10" x="752.5" y="298.2402"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="259.7266" style="stroke:#A80036;stroke-width:1.0;" width="10" x="757.5" y="2604.2207"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="2152.7383" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1065.5" y="370.8613"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="257.1738" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1339.5" y="454.793"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="87.9316" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1339.5" y="2318.1152"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="113.9316" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1567.5" y="484.1035"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="29.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1567.5" y="2347.4258"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="146.5527" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1729.5" y="839.209"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="87.9316" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1896" y="1155.3145"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="87.9316" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1896" y="1327.1777"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="87.9316" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1896" y="1483.7305"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="103.2422" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1896" y="1655.5938"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="87.9316" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1896" y="1867.0781"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="87.9316" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1896" y="1984.3203"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="29.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2207" y="1184.625"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="29.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2207" y="1356.4883"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="29.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2207" y="1513.041"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="29.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2207" y="1700.2148"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="29.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2207" y="1896.3887"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="29.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2207" y="2013.6309"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="87.9316" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2323.5" y="868.5195"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="215.1738" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2323.5" y="2985.8789"/><rect fill="#FFFFFF" filter="url(#flnns3syfb0ss)" height="185.8633" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2585.5" y="3015.1895"/><polygon fill="#A80036" points="228.5,150.998,238.5,154.998,228.5,158.998,232.5,154.998" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="38.5" x2="234.5" y1="154.998" y2="154.998"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="45.5" y="150.2559">Enter question</text><polygon fill="#A80036" points="465.5,180.3086,475.5,184.3086,465.5,188.3086,469.5,184.3086" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="250.5" x2="471.5" y1="184.3086" y2="184.3086"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205" x="257.5" y="179.5664">send_message_stream(question)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="487.5" x2="529.5" y1="213.6191" y2="213.6191"/><line style="stroke:#A80036;stroke-width:1.0;" x1="529.5" x2="529.5" y1="213.6191" y2="226.6191"/><line style="stroke:#A80036;stroke-width:1.0;" x1="488.5" x2="529.5" y1="226.6191" y2="226.6191"/><polygon fill="#A80036" points="498.5,222.6191,488.5,226.6191,498.5,230.6191,494.5,226.6191" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="169" x="494.5" y="208.877">Create user Message entity</text><line style="stroke:#A80036;stroke-width:1.0;" x1="487.5" x2="529.5" y1="255.9297" y2="255.9297"/><line style="stroke:#A80036;stroke-width:1.0;" x1="529.5" x2="529.5" y1="255.9297" y2="268.9297"/><line style="stroke:#A80036;stroke-width:1.0;" x1="488.5" x2="529.5" y1="268.9297" y2="268.9297"/><polygon fill="#A80036" points="498.5,264.9297,488.5,268.9297,498.5,272.9297,494.5,268.9297" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94" x="494.5" y="251.1875">Add to session</text><polygon fill="#A80036" points="740.5,294.2402,750.5,298.2402,740.5,302.2402,744.5,298.2402" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="487.5" x2="746.5" y1="298.2402" y2="298.2402"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="200" x="494.5" y="293.498">query_stream(question, history)</text><rect fill="#EEEEEE" filter="url(#flnns3syfb0ss)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="2658" x="0" y="326.8955"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2658" y1="326.8955" y2="326.8955"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2658" y1="329.8955" y2="329.8955"/><rect fill="#EEEEEE" filter="url(#flnns3syfb0ss)" height="23.3105" style="stroke:#000000;stroke-width:2.0;" width="255" x="1201.5" y="316.2402"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="237" x="1207.5" y="332.8086">Phase 1: Vector Search (ChromaDB)</text><polygon fill="#A80036" points="1053.5,366.8613,1063.5,370.8613,1053.5,374.8613,1057.5,370.8613" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="762.5" x2="1059.5" y1="370.8613" y2="370.8613"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110" x="769.5" y="366.1191">retrieve(question)</text><path d="M1080,383.8613 L1080,423.8613 L1272,423.8613 L1272,393.8613 L1262,383.8613 L1080,383.8613 " fill="#FBFB77" filter="url(#flnns3syfb0ss)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1262,383.8613 L1262,393.8613 L1272,393.8613 L1262,383.8613 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171" x="1086" y="401.4297">Step 1: Find similar chunks</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159" x="1086" y="416.7402">using semantic similarity</text><polygon fill="#A80036" points="1327.5,450.793,1337.5,454.793,1327.5,458.793,1331.5,454.793" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1075.5" x2="1333.5" y1="454.793" y2="454.793"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="190" x="1082.5" y="450.0508">search_similar(query, top_k:5)</text><polygon fill="#A80036" points="1555.5,480.1035,1565.5,484.1035,1555.5,488.1035,1559.5,484.1035" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1349.5" x2="1561.5" y1="484.1035" y2="484.1035"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="195" x="1356.5" y="479.3613">query(query_texts, n_results:5)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1577.5" x2="1619.5" y1="513.4141" y2="513.4141"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1619.5" x2="1619.5" y1="513.4141" y2="526.4141"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1578.5" x2="1619.5" y1="526.4141" y2="526.4141"/><polygon fill="#A80036" points="1588.5,522.4141,1578.5,526.4141,1588.5,530.4141,1584.5,526.4141" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="1584.5" y="508.6719">Compute embeddings</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1577.5" x2="1619.5" y1="555.7246" y2="555.7246"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1619.5" x2="1619.5" y1="555.7246" y2="568.7246"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1578.5" x2="1619.5" y1="568.7246" y2="568.7246"/><polygon fill="#A80036" points="1588.5,564.7246,1578.5,568.7246,1588.5,572.7246,1584.5,568.7246" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="1584.5" y="550.9824">Search similar vectors</text><polygon fill="#A80036" points="1360.5,594.0352,1350.5,598.0352,1360.5,602.0352,1356.5,598.0352" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1354.5" x2="1571.5" y1="598.0352" y2="598.0352"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="1366.5" y="593.293">Chunks with distances</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1349.5" x2="1391.5" y1="627.3457" y2="627.3457"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1391.5" x2="1391.5" y1="627.3457" y2="640.3457"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1350.5" x2="1391.5" y1="640.3457" y2="640.3457"/><polygon fill="#A80036" points="1360.5,636.3457,1350.5,640.3457,1360.5,644.3457,1356.5,640.3457" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="204" x="1356.5" y="622.6035">Convert distances to similarities</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1349.5" x2="1391.5" y1="669.6563" y2="669.6563"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1391.5" x2="1391.5" y1="669.6563" y2="682.6563"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1350.5" x2="1391.5" y1="682.6563" y2="682.6563"/><polygon fill="#A80036" points="1360.5,678.6563,1350.5,682.6563,1360.5,686.6563,1356.5,682.6563" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171" x="1356.5" y="664.9141">Filter by threshold (&gt;= 0.4)</text><polygon fill="#A80036" points="1086.5,707.9668,1076.5,711.9668,1086.5,715.9668,1082.5,711.9668" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1080.5" x2="1343.5" y1="711.9668" y2="711.9668"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="225" x="1092.5" y="707.2246">List of (Document, similarity_score)</text><path d="M1080,724.9668 L1080,764.9668 L1258,764.9668 L1258,734.9668 L1248,724.9668 L1080,724.9668 " fill="#FBFB77" filter="url(#flnns3syfb0ss)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1248,724.9668 L1248,734.9668 L1258,734.9668 L1248,724.9668 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="1086" y="742.5352">Found N relevant chunks</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="1086" y="757.8457">from vector search</text><rect fill="#EEEEEE" filter="url(#flnns3syfb0ss)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="2658" x="0" y="795.2432"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2658" y1="795.2432" y2="795.2432"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2658" y1="798.2432" y2="798.2432"/><rect fill="#EEEEEE" filter="url(#flnns3syfb0ss)" height="23.3105" style="stroke:#000000;stroke-width:2.0;" width="189" x="1234.5" y="784.5879"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="171" x="1240.5" y="801.1563">Phase 2: Entity Extraction</text><polygon fill="#A80036" points="1717.5,835.209,1727.5,839.209,1717.5,843.209,1721.5,839.209" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1075.5" x2="1723.5" y1="839.209" y2="839.209"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="1082.5" y="834.4668">extract_entities_from_query(query)</text><polygon fill="#A80036" points="2311.5,864.5195,2321.5,868.5195,2311.5,872.5195,2315.5,868.5195" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1739.5" x2="2317.5" y1="868.5195" y2="868.5195"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="286" x="1746.5" y="863.7773">generate_response(entity_extraction_prompt)</text><polygon fill="#A80036" points="2578.5,893.8301,2588.5,897.8301,2578.5,901.8301,2582.5,897.8301" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2333.5" x2="2584.5" y1="897.8301" y2="897.8301"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155" x="2340.5" y="893.0879">Chat completion request</text><polygon fill="#A80036" points="2344.5,923.1406,2334.5,927.1406,2344.5,931.1406,2340.5,927.1406" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2338.5" x2="2589.5" y1="927.1406" y2="927.1406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="2350.5" y="922.3984">JSON with entities</text><polygon fill="#A80036" points="1750.5,952.4512,1740.5,956.4512,1750.5,960.4512,1746.5,956.4512" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1744.5" x2="2327.5" y1="956.4512" y2="956.4512"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="60" x="1756.5" y="951.709">Entity list</text><polygon fill="#A80036" points="1086.5,981.7617,1076.5,985.7617,1086.5,989.7617,1082.5,985.7617" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1080.5" x2="1733.5" y1="985.7617" y2="985.7617"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="1092.5" y="981.0195">Query entities</text><rect fill="#EEEEEE" filter="url(#flnns3syfb0ss)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="2658" x="0" y="1014.417"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2658" y1="1014.417" y2="1014.417"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2658" y1="1017.417" y2="1017.417"/><rect fill="#EEEEEE" filter="url(#flnns3syfb0ss)" height="23.3105" style="stroke:#000000;stroke-width:2.0;" width="255" x="1201.5" y="1003.7617"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="237" x="1207.5" y="1020.3301">Phase 3: Graph Enrichment (Neo4j)</text><path d="M1080,1042.0723 L1080,1082.0723 L1277,1082.0723 L1277,1052.0723 L1267,1042.0723 L1080,1042.0723 " fill="#FBFB77" filter="url(#flnns3syfb0ss)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1267,1042.0723 L1267,1052.0723 L1277,1052.0723 L1267,1042.0723 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="1086" y="1059.6406">Step 2: Extract entities from</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="1086" y="1074.9512">vector chunks in graph</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1075.5" x2="1117.5" y1="1113.0039" y2="1113.0039"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1117.5" x2="1117.5" y1="1113.0039" y2="1126.0039"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1076.5" x2="1117.5" y1="1126.0039" y2="1126.0039"/><polygon fill="#A80036" points="1086.5,1122.0039,1076.5,1126.0039,1086.5,1130.0039,1082.5,1126.0039" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213" x="1082.5" y="1108.2617">Get chunk IDs from vector results</text><polygon fill="#A80036" points="1884,1151.3145,1894,1155.3145,1884,1159.3145,1888,1155.3145" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1075.5" x2="1890" y1="1155.3145" y2="1155.3145"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="225" x="1082.5" y="1150.5723">get_entities_for_chunks(chunk_ids)</text><polygon fill="#A80036" points="2195,1180.625,2205,1184.625,2195,1188.625,2199,1184.625" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1906" x2="2201" y1="1184.625" y2="1184.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="271" x="1913" y="1179.8828">MATCH (c:Chunk)-[:MENTIONS]-&gt;(e:Entity)</text><polygon fill="#A80036" points="1917,1209.9355,1907,1213.9355,1917,1217.9355,1913,1213.9355" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1911" x2="2211" y1="1213.9355" y2="1213.9355"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="1923" y="1209.1934">Entities for each chunk</text><polygon fill="#A80036" points="1086.5,1239.2461,1076.5,1243.2461,1086.5,1247.2461,1082.5,1243.2461" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1080.5" x2="1900" y1="1243.2461" y2="1243.2461"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127" x="1092.5" y="1238.5039">chunk_entities_map</text><path d="M1080,1256.2461 L1080,1296.2461 L1277,1296.2461 L1277,1266.2461 L1267,1256.2461 L1080,1256.2461 " fill="#FBFB77" filter="url(#flnns3syfb0ss)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1267,1256.2461 L1267,1266.2461 L1277,1266.2461 L1267,1256.2461 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="1086" y="1273.8145">Step 3: Find related entities</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="1086" y="1289.125">through graph relationships</text><polygon fill="#A80036" points="1884,1323.1777,1894,1327.1777,1884,1331.1777,1888,1327.1777" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1075.5" x2="1890" y1="1327.1777" y2="1327.1777"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="284" x="1082.5" y="1322.4355">get_related_entities(entity_ids, max_depth:2)</text><polygon fill="#A80036" points="2195,1352.4883,2205,1356.4883,2195,1360.4883,2199,1356.4883" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1906" x2="2201" y1="1356.4883" y2="1356.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="282" x="1913" y="1351.7461">MATCH path = (e1)-[:RELATED_TO*1..2]-(e2)</text><polygon fill="#A80036" points="1917,1381.7988,1907,1385.7988,1917,1389.7988,1913,1385.7988" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1911" x2="2211" y1="1385.7988" y2="1385.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211" x="1923" y="1381.0566">Related entities with path lengths</text><polygon fill="#A80036" points="1086.5,1411.1094,1076.5,1415.1094,1086.5,1419.1094,1082.5,1415.1094" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1080.5" x2="1900" y1="1415.1094" y2="1415.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="1092.5" y="1410.3672">Related entities list</text><path d="M1080,1428.1094 L1080,1453.1094 L1295,1453.1094 L1295,1438.1094 L1285,1428.1094 L1080,1428.1094 " fill="#FBFB77" filter="url(#flnns3syfb0ss)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1285,1428.1094 L1285,1438.1094 L1295,1438.1094 L1285,1428.1094 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="194" x="1086" y="1445.6777">Step 4: Get entity relationships</text><polygon fill="#A80036" points="1884,1479.7305,1894,1483.7305,1884,1487.7305,1888,1483.7305" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1075.5" x2="1890" y1="1483.7305" y2="1483.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="222" x="1082.5" y="1478.9883">get_entity_relationships(entity_ids)</text><polygon fill="#A80036" points="2195,1509.041,2205,1513.041,2195,1517.041,2199,1513.041" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1906" x2="2201" y1="1513.041" y2="1513.041"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136" x="1913" y="1508.2988">MATCH (e1)-[r]-&gt;(e2)</text><polygon fill="#A80036" points="1917,1538.3516,1907,1542.3516,1917,1546.3516,1913,1542.3516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1911" x2="2211" y1="1542.3516" y2="1542.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122" x="1923" y="1537.6094">Entity relationships</text><polygon fill="#A80036" points="1086.5,1567.6621,1076.5,1571.6621,1086.5,1575.6621,1082.5,1571.6621" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1080.5" x2="1900" y1="1571.6621" y2="1571.6621"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="1092.5" y="1566.9199">Relationships list</text><path d="M1080,1584.6621 L1080,1624.6621 L1251,1624.6621 L1251,1594.6621 L1241,1584.6621 L1080,1584.6621 " fill="#FBFB77" filter="url(#flnns3syfb0ss)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1241,1584.6621 L1241,1594.6621 L1251,1594.6621 L1241,1584.6621 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="1086" y="1602.2305">Step 5: Find structurally</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115" x="1086" y="1617.541">connected chunks</text><polygon fill="#A80036" points="1884,1651.5938,1894,1655.5938,1884,1659.5938,1888,1655.5938" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1075.5" x2="1890" y1="1655.5938" y2="1655.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="291" x="1082.5" y="1650.8516">find_related_chunks(chunk_ids, max_depth:2)</text><polygon fill="#A80036" points="2195,1696.2148,2205,1700.2148,2195,1704.2148,2199,1700.2148" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1906" x2="2201" y1="1700.2148" y2="1700.2148"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="223" x="1913" y="1680.1621">MATCH chunks via SHARES_ENTITY</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="1913" y="1695.4727">and entity relationships</text><polygon fill="#A80036" points="1917,1725.5254,1907,1729.5254,1917,1733.5254,1913,1729.5254" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1911" x2="2211" y1="1729.5254" y2="1729.5254"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="235" x="1923" y="1724.7832">Related chunks with relevance scores</text><polygon fill="#A80036" points="1086.5,1754.8359,1076.5,1758.8359,1086.5,1762.8359,1082.5,1758.8359" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1080.5" x2="1900" y1="1758.8359" y2="1758.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="1092.5" y="1754.0938">Related chunks list</text><path d="M1080,1771.8359 L1080,1811.8359 L1258,1811.8359 L1258,1781.8359 L1248,1771.8359 L1080,1771.8359 " fill="#FBFB77" filter="url(#flnns3syfb0ss)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1248,1771.8359 L1248,1781.8359 L1258,1781.8359 L1248,1771.8359 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="1086" y="1789.4043">Step 6: Search chunks by</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86" x="1086" y="1804.7148">query entities</text><path d="M971.5,1828.457 L1033.5,1828.457 L1033.5,1835.457 L1023.5,1845.457 L971.5,1845.457 L971.5,1828.457 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="251.7949" style="stroke:#000000;stroke-width:2.0;" width="1296.5" x="971.5" y="1828.457"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="986.5" y="1842.0254">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="123" x="1048.5" y="1841.0918">[Query entities found]</text><polygon fill="#A80036" points="1884,1863.0781,1894,1867.0781,1884,1871.0781,1888,1867.0781" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1075.5" x2="1890" y1="1867.0781" y2="1867.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="228" x="1082.5" y="1862.3359">find_entities_by_query(entity_name)</text><polygon fill="#A80036" points="2195,1892.3887,2205,1896.3887,2195,1900.3887,2199,1896.3887" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1906" x2="2201" y1="1896.3887" y2="1896.3887"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155" x="1913" y="1891.6465">MATCH entities by name</text><polygon fill="#A80036" points="1917,1921.6992,1907,1925.6992,1917,1929.6992,1913,1925.6992" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1911" x2="2211" y1="1925.6992" y2="1925.6992"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="1923" y="1920.957">Matching entities</text><polygon fill="#A80036" points="1086.5,1951.0098,1076.5,1955.0098,1086.5,1959.0098,1082.5,1955.0098" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1080.5" x2="1900" y1="1955.0098" y2="1955.0098"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="1092.5" y="1950.2676">Entity IDs</text><polygon fill="#A80036" points="1884,1980.3203,1894,1984.3203,1884,1988.3203,1888,1984.3203" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1075.5" x2="1890" y1="1984.3203" y2="1984.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="219" x="1082.5" y="1979.5781">get_chunks_by_entities(entity_ids)</text><polygon fill="#A80036" points="2195,2009.6309,2205,2013.6309,2195,2017.6309,2199,2013.6309" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1906" x2="2201" y1="2013.6309" y2="2013.6309"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="224" x="1913" y="2008.8887">MATCH chunks mentioning entities</text><polygon fill="#A80036" points="1917,2038.9414,1907,2042.9414,1917,2046.9414,1913,2042.9414" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1911" x2="2211" y1="2042.9414" y2="2042.9414"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182" x="1923" y="2038.1992">Chunks with entity mentions</text><polygon fill="#A80036" points="1086.5,2068.252,1076.5,2072.252,1086.5,2076.252,1082.5,2072.252" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1080.5" x2="1900" y1="2072.252" y2="2072.252"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131" x="1092.5" y="2067.5098">Entity-based chunks</text><rect fill="#EEEEEE" filter="url(#flnns3syfb0ss)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="2658" x="0" y="2107.9072"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2658" y1="2107.9072" y2="2107.9072"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2658" y1="2110.9072" y2="2110.9072"/><rect fill="#EEEEEE" filter="url(#flnns3syfb0ss)" height="23.3105" style="stroke:#000000;stroke-width:2.0;" width="191" x="1233.5" y="2097.252"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="173" x="1239.5" y="2113.8203">Phase 4: Combine Results</text><path d="M1080,2135.5625 L1080,2160.5625 L1348,2160.5625 L1348,2145.5625 L1338,2135.5625 L1080,2135.5625 " fill="#FBFB77" filter="url(#flnns3syfb0ss)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1338,2135.5625 L1338,2145.5625 L1348,2145.5625 L1338,2135.5625 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247" x="1086" y="2153.1309">Step 7: Combine vector + graph results</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1075.5" x2="1117.5" y1="2191.1836" y2="2191.1836"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1117.5" x2="1117.5" y1="2191.1836" y2="2204.1836"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1076.5" x2="1117.5" y1="2204.1836" y2="2204.1836"/><polygon fill="#A80036" points="1086.5,2200.1836,1076.5,2204.1836,1086.5,2208.1836,1082.5,2204.1836" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="235" x="1082.5" y="2186.4414">Merge vector chunks + graph chunks</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1075.5" x2="1117.5" y1="2233.4941" y2="2233.4941"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1117.5" x2="1117.5" y1="2233.4941" y2="2246.4941"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1076.5" x2="1117.5" y1="2246.4941" y2="2246.4941"/><polygon fill="#A80036" points="1086.5,2242.4941,1076.5,2246.4941,1086.5,2250.4941,1082.5,2246.4941" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156" x="1082.5" y="2228.752">Deduplicate by chunk_id</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1075.5" x2="1117.5" y1="2275.8047" y2="2275.8047"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1117.5" x2="1117.5" y1="2275.8047" y2="2288.8047"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1076.5" x2="1117.5" y1="2288.8047" y2="2288.8047"/><polygon fill="#A80036" points="1086.5,2284.8047,1076.5,2288.8047,1086.5,2292.8047,1082.5,2288.8047" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="1082.5" y="2271.0625">Sort by relevance score</text><polygon fill="#A80036" points="1327.5,2314.1152,1337.5,2318.1152,1327.5,2322.1152,1331.5,2318.1152" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1075.5" x2="1333.5" y1="2318.1152" y2="2318.1152"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="245" x="1082.5" y="2313.373">Get full chunk content from ChromaDB</text><polygon fill="#A80036" points="1555.5,2343.4258,1565.5,2347.4258,1555.5,2351.4258,1559.5,2347.4258" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1349.5" x2="1561.5" y1="2347.4258" y2="2347.4258"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="1356.5" y="2342.6836">get(ids=[chunk_ids])</text><polygon fill="#A80036" points="1360.5,2372.7363,1350.5,2376.7363,1360.5,2380.7363,1356.5,2376.7363" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1354.5" x2="1571.5" y1="2376.7363" y2="2376.7363"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="1366.5" y="2371.9941">Full chunk content</text><polygon fill="#A80036" points="1086.5,2402.0469,1076.5,2406.0469,1086.5,2410.0469,1082.5,2406.0469" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1080.5" x2="1343.5" y1="2406.0469" y2="2406.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177" x="1092.5" y="2401.3047">Complete chunk documents</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1075.5" x2="1117.5" y1="2481.2891" y2="2481.2891"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1117.5" x2="1117.5" y1="2481.2891" y2="2494.2891"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1076.5" x2="1117.5" y1="2494.2891" y2="2494.2891"/><polygon fill="#A80036" points="1086.5,2490.2891,1076.5,2494.2891,1086.5,2498.2891,1082.5,2494.2891" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="1082.5" y="2430.6152">Build graph_context dictionary:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59" x="1082.5" y="2445.9258">- entities</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94" x="1082.5" y="2461.2363">- relationships</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105" x="1082.5" y="2476.5469">- chunk_entities</text><polygon fill="#A80036" points="773.5,2519.5996,763.5,2523.5996,773.5,2527.5996,769.5,2523.5996" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="767.5" x2="1069.5" y1="2523.5996" y2="2523.5996"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="279" x="779.5" y="2518.8574">(combined_chunks, sources, graph_context)</text><rect fill="#EEEEEE" filter="url(#flnns3syfb0ss)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="2658" x="0" y="2552.2549"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2658" y1="2552.2549" y2="2552.2549"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2658" y1="2555.2549" y2="2555.2549"/><rect fill="#EEEEEE" filter="url(#flnns3syfb0ss)" height="23.3105" style="stroke:#000000;stroke-width:2.0;" width="190" x="1234" y="2541.5996"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="172" x="1240" y="2558.168">Phase 5: Context Building</text><line style="stroke:#A80036;stroke-width:1.0;" x1="762.5" x2="809.5" y1="2591.2207" y2="2591.2207"/><line style="stroke:#A80036;stroke-width:1.0;" x1="809.5" x2="809.5" y1="2591.2207" y2="2604.2207"/><line style="stroke:#A80036;stroke-width:1.0;" x1="768.5" x2="809.5" y1="2604.2207" y2="2604.2207"/><polygon fill="#A80036" points="778.5,2600.2207,768.5,2604.2207,778.5,2608.2207,774.5,2604.2207" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247" x="774.5" y="2586.4785">_build_context(chunks, graph_context)</text><path d="M772,2622.2207 L772,2723.2207 L1011,2723.2207 L1011,2632.2207 L1001,2622.2207 L772,2622.2207 " fill="#FBFB77" filter="url(#flnns3syfb0ss)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1001,2622.2207 L1001,2632.2207 L1011,2632.2207 L1001,2622.2207 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="778" y="2639.7891">Build enriched context:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="218" x="778" y="2655.0996">1. Vector chunks (from ChromaDB)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="778" y="2670.4102">2. Graph chunks (from Neo4j)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="200" x="778" y="2685.7207">3. Entities mentioned in chunks</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="778" y="2701.0313">4. Related entities</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="778" y="2716.3418">5. Entity relationships</text><line style="stroke:#A80036;stroke-width:1.0;" x1="767.5" x2="809.5" y1="2815.6367" y2="2815.6367"/><line style="stroke:#A80036;stroke-width:1.0;" x1="809.5" x2="809.5" y1="2815.6367" y2="2828.6367"/><line style="stroke:#A80036;stroke-width:1.0;" x1="768.5" x2="809.5" y1="2828.6367" y2="2828.6367"/><polygon fill="#A80036" points="778.5,2824.6367,768.5,2828.6367,778.5,2832.6367,774.5,2828.6367" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188" x="774.5" y="2749.6523">Format context with sections:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="774.5" y="2764.9629">- Relevant Document Chunks</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="774.5" y="2780.2734">- Entities Mentioned</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="774.5" y="2795.584">- Related Entities</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="774.5" y="2810.8945">- Entity Relationships</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="767.5" x2="809.5" y1="2862.9473" y2="2862.9473"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="809.5" x2="809.5" y1="2862.9473" y2="2875.9473"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="762.5" x2="809.5" y1="2875.9473" y2="2875.9473"/><polygon fill="#A80036" points="772.5,2871.9473,762.5,2875.9473,772.5,2879.9473,768.5,2875.9473" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153" x="774.5" y="2858.2051">Complete context string</text><rect fill="#EEEEEE" filter="url(#flnns3syfb0ss)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="2658" x="0" y="2899.6025"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2658" y1="2899.6025" y2="2899.6025"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2658" y1="2902.6025" y2="2902.6025"/><rect fill="#EEEEEE" filter="url(#flnns3syfb0ss)" height="23.3105" style="stroke:#000000;stroke-width:2.0;" width="153" x="1252.5" y="2888.9473"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="135" x="1258.5" y="2905.5156">Phase 6: Generation</text><line style="stroke:#A80036;stroke-width:1.0;" x1="762.5" x2="804.5" y1="2943.5684" y2="2943.5684"/><line style="stroke:#A80036;stroke-width:1.0;" x1="804.5" x2="804.5" y1="2943.5684" y2="2956.5684"/><line style="stroke:#A80036;stroke-width:1.0;" x1="763.5" x2="804.5" y1="2956.5684" y2="2956.5684"/><polygon fill="#A80036" points="773.5,2952.5684,763.5,2956.5684,773.5,2960.5684,769.5,2956.5684" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="253" x="769.5" y="2938.8262">Prepare messages with enriched context</text><polygon fill="#A80036" points="2311.5,2981.8789,2321.5,2985.8789,2311.5,2989.8789,2315.5,2985.8789" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="762.5" x2="2317.5" y1="2985.8789" y2="2985.8789"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="294" x="769.5" y="2981.1367">generate_response_stream(messages, context)</text><polygon fill="#A80036" points="2573.5,3011.1895,2583.5,3015.1895,2573.5,3019.1895,2577.5,3015.1895" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2333.5" x2="2579.5" y1="3015.1895" y2="3015.1895"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="233" x="2340.5" y="3010.4473">Create chat completion (stream:True)</text><path d="M10,3030.1895 L84,3030.1895 L84,3037.1895 L74,3047.1895 L10,3047.1895 L10,3030.1895 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="163.8633" style="stroke:#000000;stroke-width:2.0;" width="2638" x="10" y="3030.1895"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="25" y="3043.7578">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="90" x="99" y="3042.8242">[Stream chunks]</text><polygon fill="#A80036" points="2344.5,3064.8105,2334.5,3068.8105,2344.5,3072.8105,2340.5,3068.8105" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2338.5" x2="2584.5" y1="3068.8105" y2="3068.8105"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="2350.5" y="3064.0684">Response chunk</text><polygon fill="#A80036" points="773.5,3094.1211,763.5,3098.1211,773.5,3102.1211,769.5,3098.1211" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="767.5" x2="2322.5" y1="3098.1211" y2="3098.1211"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="779.5" y="3093.3789">Text chunk</text><polygon fill="#A80036" points="498.5,3123.4316,488.5,3127.4316,498.5,3131.4316,494.5,3127.4316" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="492.5" x2="751.5" y1="3127.4316" y2="3127.4316"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="504.5" y="3122.6895">Text chunk</text><polygon fill="#A80036" points="261.5,3152.7422,251.5,3156.7422,261.5,3160.7422,257.5,3156.7422" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="255.5" x2="476.5" y1="3156.7422" y2="3156.7422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90" x="267.5" y="3152">Display chunk</text><polygon fill="#A80036" points="49.5,3182.0527,39.5,3186.0527,49.5,3190.0527,45.5,3186.0527" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="43.5" x2="239.5" y1="3186.0527" y2="3186.0527"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="55.5" y="3181.3105">Show streaming text</text><rect fill="#EEEEEE" filter="url(#flnns3syfb0ss)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="2658" x="0" y="3221.708"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2658" y1="3221.708" y2="3221.708"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2658" y1="3224.708" y2="3224.708"/><rect fill="#EEEEEE" filter="url(#flnns3syfb0ss)" height="23.3105" style="stroke:#000000;stroke-width:2.0;" width="96" x="1281" y="3211.0527"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="78" x="1287" y="3227.6211">Finalization</text><polygon fill="#A80036" points="498.5,3261.6738,488.5,3265.6738,498.5,3269.6738,494.5,3265.6738" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="492.5" x2="756.5" y1="3265.6738" y2="3265.6738"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="241" x="504.5" y="3260.9316">Source document IDs + graph sources</text><line style="stroke:#A80036;stroke-width:1.0;" x1="487.5" x2="529.5" y1="3294.9844" y2="3294.9844"/><line style="stroke:#A80036;stroke-width:1.0;" x1="529.5" x2="529.5" y1="3294.9844" y2="3307.9844"/><line style="stroke:#A80036;stroke-width:1.0;" x1="488.5" x2="529.5" y1="3307.9844" y2="3307.9844"/><polygon fill="#A80036" points="498.5,3303.9844,488.5,3307.9844,498.5,3311.9844,494.5,3307.9844" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159" x="494.5" y="3290.2422">Create assistant Message</text><line style="stroke:#A80036;stroke-width:1.0;" x1="487.5" x2="529.5" y1="3337.2949" y2="3337.2949"/><line style="stroke:#A80036;stroke-width:1.0;" x1="529.5" x2="529.5" y1="3337.2949" y2="3350.2949"/><line style="stroke:#A80036;stroke-width:1.0;" x1="488.5" x2="529.5" y1="3350.2949" y2="3350.2949"/><polygon fill="#A80036" points="498.5,3346.2949,488.5,3350.2949,498.5,3354.2949,494.5,3350.2949" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94" x="494.5" y="3332.5527">Add to session</text><polygon fill="#A80036" points="261.5,3375.6055,251.5,3379.6055,261.5,3383.6055,257.5,3379.6055" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="255.5" x2="481.5" y1="3379.6055" y2="3379.6055"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203" x="267.5" y="3374.8633">Complete message with sources</text><polygon fill="#A80036" points="49.5,3420.2266,39.5,3424.2266,49.5,3428.2266,45.5,3424.2266" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="43.5" x2="244.5" y1="3424.2266" y2="3424.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178" x="55.5" y="3404.1738">Show response with sources</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="55.5" y="3419.4844">(Vector &#128202; and Graph &#128376;)</text><!--MD5=[bec8c72d2490eeea4c093c6594008a80]
@startuml

title Graph RAG Query Flow - Hybrid Context Building (Vector DB + Graph DB)

actor User
participant "Streamlit UI" as UI
participant "Chat Service" as Chat
participant "RAG Service" as RAG
participant "Hybrid Retrieval Service" as Hybrid
participant "ChromaDocumentRepository" as VectorRepo
participant "ChromaDB\n(Vector DB)" as Chroma
participant "Entity Extraction Service" as EntityExtract
participant "Neo4jRepository" as GraphRepo
participant "Neo4j\n(Graph DB)" as Neo4j
participant "OpenAI Service" as OpenAI
participant "OpenAI API" as API

User -> UI: Enter question
activate UI

UI -> Chat: send_message_stream(question)
activate Chat

Chat -> Chat: Create user Message entity
Chat -> Chat: Add to session

Chat -> RAG: query_stream(question, history)
activate RAG

== Phase 1: Vector Search (ChromaDB) ==

RAG -> Hybrid: retrieve(question)
activate Hybrid

note right of Hybrid: Step 1: Find similar chunks\nusing semantic similarity

Hybrid -> VectorRepo: search_similar(query, top_k:5)
activate VectorRepo

VectorRepo -> Chroma: query(query_texts, n_results:5)
activate Chroma
Chroma -> Chroma: Compute embeddings
Chroma -> Chroma: Search similar vectors
Chroma - -> VectorRepo: Chunks with distances
deactivate Chroma

VectorRepo -> VectorRepo: Convert distances to similarities
VectorRepo -> VectorRepo: Filter by threshold (>= 0.4)
VectorRepo - -> Hybrid: List of (Document, similarity_score)
deactivate VectorRepo

note right of Hybrid: Found N relevant chunks\nfrom vector search

== Phase 2: Entity Extraction ==

Hybrid -> EntityExtract: extract_entities_from_query(query)
activate EntityExtract
EntityExtract -> OpenAI: generate_response(entity_extraction_prompt)
activate OpenAI
OpenAI -> API: Chat completion request
API - -> OpenAI: JSON with entities
OpenAI - -> EntityExtract: Entity list
deactivate OpenAI
EntityExtract - -> Hybrid: Query entities
deactivate EntityExtract

== Phase 3: Graph Enrichment (Neo4j) ==

note right of Hybrid: Step 2: Extract entities from\nvector chunks in graph

Hybrid -> Hybrid: Get chunk IDs from vector results
Hybrid -> GraphRepo: get_entities_for_chunks(chunk_ids)
activate GraphRepo
GraphRepo -> Neo4j: MATCH (c:Chunk)-[:MENTIONS]->(e:Entity)
activate Neo4j
Neo4j - -> GraphRepo: Entities for each chunk
deactivate Neo4j
GraphRepo - -> Hybrid: chunk_entities_map
deactivate GraphRepo

note right of Hybrid: Step 3: Find related entities\nthrough graph relationships

Hybrid -> GraphRepo: get_related_entities(entity_ids, max_depth:2)
activate GraphRepo
GraphRepo -> Neo4j: MATCH path = (e1)-[:RELATED_TO*1..2]-(e2)
activate Neo4j
Neo4j - -> GraphRepo: Related entities with path lengths
deactivate Neo4j
GraphRepo - -> Hybrid: Related entities list
deactivate GraphRepo

note right of Hybrid: Step 4: Get entity relationships

Hybrid -> GraphRepo: get_entity_relationships(entity_ids)
activate GraphRepo
GraphRepo -> Neo4j: MATCH (e1)-[r]->(e2)
activate Neo4j
Neo4j - -> GraphRepo: Entity relationships
deactivate Neo4j
GraphRepo - -> Hybrid: Relationships list
deactivate GraphRepo

note right of Hybrid: Step 5: Find structurally\nconnected chunks

Hybrid -> GraphRepo: find_related_chunks(chunk_ids, max_depth:2)
activate GraphRepo
GraphRepo -> Neo4j: MATCH chunks via SHARES_ENTITY\nand entity relationships
activate Neo4j
Neo4j - -> GraphRepo: Related chunks with relevance scores
deactivate Neo4j
GraphRepo - -> Hybrid: Related chunks list
deactivate GraphRepo

note right of Hybrid: Step 6: Search chunks by\nquery entities

alt Query entities found
    Hybrid -> GraphRepo: find_entities_by_query(entity_name)
    activate GraphRepo
    GraphRepo -> Neo4j: MATCH entities by name
    activate Neo4j
    Neo4j - -> GraphRepo: Matching entities
    deactivate Neo4j
    GraphRepo - -> Hybrid: Entity IDs
    deactivate GraphRepo
    
    Hybrid -> GraphRepo: get_chunks_by_entities(entity_ids)
    activate GraphRepo
    GraphRepo -> Neo4j: MATCH chunks mentioning entities
    activate Neo4j
    Neo4j - -> GraphRepo: Chunks with entity mentions
    deactivate Neo4j
    GraphRepo - -> Hybrid: Entity-based chunks
    deactivate GraphRepo
end

== Phase 4: Combine Results ==

note right of Hybrid: Step 7: Combine vector + graph results

Hybrid -> Hybrid: Merge vector chunks + graph chunks
Hybrid -> Hybrid: Deduplicate by chunk_id
Hybrid -> Hybrid: Sort by relevance score
Hybrid -> VectorRepo: Get full chunk content from ChromaDB
activate VectorRepo
VectorRepo -> Chroma: get(ids=[chunk_ids])
activate Chroma
Chroma - -> VectorRepo: Full chunk content
deactivate Chroma
VectorRepo - -> Hybrid: Complete chunk documents
deactivate VectorRepo

Hybrid -> Hybrid: Build graph_context dictionary:\n- entities\n- relationships\n- chunk_entities

Hybrid - -> RAG: (combined_chunks, sources, graph_context)
deactivate Hybrid

== Phase 5: Context Building ==

RAG -> RAG: _build_context(chunks, graph_context)
activate RAG

note right of RAG: Build enriched context:\n1. Vector chunks (from ChromaDB)\n2. Graph chunks (from Neo4j)\n3. Entities mentioned in chunks\n4. Related entities\n5. Entity relationships

RAG -> RAG: Format context with sections:\n- Relevant Document Chunks\n- Entities Mentioned\n- Related Entities\n- Entity Relationships

RAG - -> RAG: Complete context string
deactivate RAG

== Phase 6: Generation ==

RAG -> RAG: Prepare messages with enriched context
RAG -> OpenAI: generate_response_stream(messages, context)
activate OpenAI

OpenAI -> API: Create chat completion (stream:True)
activate API

loop Stream chunks
    API - -> OpenAI: Response chunk
    OpenAI - -> RAG: Text chunk
    RAG - -> Chat: Text chunk
    Chat - -> UI: Display chunk
    UI - -> User: Show streaming text
end

deactivate API
deactivate OpenAI

== Finalization ==

RAG - -> Chat: Source document IDs + graph sources
deactivate RAG

Chat -> Chat: Create assistant Message
Chat -> Chat: Add to session
Chat - -> UI: Complete message with sources
deactivate Chat

UI - -> User: Show response with sources\n(Vector  and Graph )
deactivate UI

@enduml

PlantUML version 1.2021.00(Sun Jan 10 18:25:05 SGT 2021)
(MIT source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: SG
--></g></svg>