<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="839px" preserveAspectRatio="none" style="width:1324px;height:839px;" version="1.1" viewBox="0 0 1324 839" width="1324px" zoomAndPan="magnify"><defs><filter height="300%" id="fctk4vvicf3lm" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="201" x="559.5" y="29.4023">Document Upload Flow</text><rect fill="#FFFFFF" filter="url(#fctk4vvicf3lm)" height="581.5898" style="stroke:#A80036;stroke-width:1.0;" width="10" x="207.5" y="154.998"/><rect fill="#FFFFFF" filter="url(#fctk4vvicf3lm)" height="172.5527" style="stroke:#A80036;stroke-width:1.0;" width="10" x="459.5" y="184.3086"/><rect fill="#FFFFFF" filter="url(#fctk4vvicf3lm)" height="71.6211" style="stroke:#A80036;stroke-width:1.0;" width="10" x="637.5" y="255.9297"/><rect fill="#FFFFFF" filter="url(#fctk4vvicf3lm)" height="321.1055" style="stroke:#A80036;stroke-width:1.0;" width="10" x="763.5" y="386.1719"/><rect fill="#FFFFFF" filter="url(#fctk4vvicf3lm)" height="262.4844" style="stroke:#A80036;stroke-width:1.0;" width="10" x="931" y="415.4824"/><rect fill="#FFFFFF" filter="url(#fctk4vvicf3lm)" height="29.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1143" y="444.793"/><rect fill="#FFFFFF" filter="url(#fctk4vvicf3lm)" height="29.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1249.5" y="570.0352"/><rect fill="#FFFFFF" filter="url(#fctk4vvicf3lm)" height="75.9316" style="stroke:#000000;stroke-width:2.0;" width="492" x="818" y="531.4141"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="23" x2="23" y1="123.6875" y2="754.5879"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="212" x2="212" y1="123.6875" y2="754.5879"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="464" x2="464" y1="123.6875" y2="754.5879"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="642.5" x2="642.5" y1="123.6875" y2="754.5879"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="768" x2="768" y1="123.6875" y2="754.5879"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="936" x2="936" y1="123.6875" y2="754.5879"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1148" x2="1148" y1="123.6875" y2="754.5879"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1254" x2="1254" y1="123.6875" y2="754.5879"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="5" y="120.7344">User</text><ellipse cx="23.5" cy="50.1992" fill="#FEFECE" filter="url(#fctk4vvicf3lm)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M23.5,58.1992 L23.5,85.1992 M10.5,66.1992 L36.5,66.1992 M23.5,85.1992 L10.5,100.1992 M23.5,85.1992 L36.5,100.1992 " fill="none" filter="url(#fctk4vvicf3lm)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="5" y="767.123">User</text><ellipse cx="23.5" cy="780.0762" fill="#FEFECE" filter="url(#fctk4vvicf3lm)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M23.5,788.0762 L23.5,815.0762 M10.5,796.0762 L36.5,796.0762 M23.5,815.0762 L10.5,830.0762 M23.5,815.0762 L36.5,830.0762 " fill="none" filter="url(#fctk4vvicf3lm)" style="stroke:#A80036;stroke-width:2.0;"/><rect fill="#FEFECE" filter="url(#fctk4vvicf3lm)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="93" x="164" y="88.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="171" y="108.7344">Streamlit UI</text><rect fill="#FEFECE" filter="url(#fctk4vvicf3lm)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="93" x="164" y="753.5879"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="171" y="774.123">Streamlit UI</text><rect fill="#FEFECE" filter="url(#fctk4vvicf3lm)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="131" x="397" y="88.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="117" x="404" y="108.7344">DocumentLoader</text><rect fill="#FEFECE" filter="url(#fctk4vvicf3lm)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="131" x="397" y="753.5879"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="117" x="404" y="774.123">DocumentLoader</text><rect fill="#FEFECE" filter="url(#fctk4vvicf3lm)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="126" x="577.5" y="88.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="584.5" y="108.7344">Document Entity</text><rect fill="#FEFECE" filter="url(#fctk4vvicf3lm)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="126" x="577.5" y="753.5879"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="584.5" y="774.123">Document Entity</text><rect fill="#FEFECE" filter="url(#fctk4vvicf3lm)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="95" x="719" y="88.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="726" y="108.7344">RAG Service</text><rect fill="#FEFECE" filter="url(#fctk4vvicf3lm)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="95" x="719" y="753.5879"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="726" y="774.123">RAG Service</text><rect fill="#FEFECE" filter="url(#fctk4vvicf3lm)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="212" x="828" y="88.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="198" x="835" y="108.7344">ChromaDocumentRepository</text><rect fill="#FEFECE" filter="url(#fctk4vvicf3lm)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="212" x="828" y="753.5879"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="198" x="835" y="774.123">ChromaDocumentRepository</text><rect fill="#FEFECE" filter="url(#fctk4vvicf3lm)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="98" x="1097" y="88.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="1104" y="108.7344">Text Splitter</text><rect fill="#FEFECE" filter="url(#fctk4vvicf3lm)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="98" x="1097" y="753.5879"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="1104" y="774.123">Text Splitter</text><rect fill="#FEFECE" filter="url(#fctk4vvicf3lm)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="87" x="1209" y="88.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73" x="1216" y="108.7344">ChromaDB</text><rect fill="#FEFECE" filter="url(#fctk4vvicf3lm)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="87" x="1209" y="753.5879"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73" x="1216" y="774.123">ChromaDB</text><rect fill="#FFFFFF" filter="url(#fctk4vvicf3lm)" height="581.5898" style="stroke:#A80036;stroke-width:1.0;" width="10" x="207.5" y="154.998"/><rect fill="#FFFFFF" filter="url(#fctk4vvicf3lm)" height="172.5527" style="stroke:#A80036;stroke-width:1.0;" width="10" x="459.5" y="184.3086"/><rect fill="#FFFFFF" filter="url(#fctk4vvicf3lm)" height="71.6211" style="stroke:#A80036;stroke-width:1.0;" width="10" x="637.5" y="255.9297"/><rect fill="#FFFFFF" filter="url(#fctk4vvicf3lm)" height="321.1055" style="stroke:#A80036;stroke-width:1.0;" width="10" x="763.5" y="386.1719"/><rect fill="#FFFFFF" filter="url(#fctk4vvicf3lm)" height="262.4844" style="stroke:#A80036;stroke-width:1.0;" width="10" x="931" y="415.4824"/><rect fill="#FFFFFF" filter="url(#fctk4vvicf3lm)" height="29.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1143" y="444.793"/><rect fill="#FFFFFF" filter="url(#fctk4vvicf3lm)" height="29.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1249.5" y="570.0352"/><polygon fill="#A80036" points="195.5,150.998,205.5,154.998,195.5,158.998,199.5,154.998" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="23.5" x2="201.5" y1="154.998" y2="154.998"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131" x="30.5" y="150.2559">Upload PDF/Text file</text><polygon fill="#A80036" points="447.5,180.3086,457.5,184.3086,447.5,188.3086,451.5,184.3086" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="217.5" x2="453.5" y1="184.3086" y2="184.3086"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="223" x="224.5" y="179.5664">load_from_pdf(file_bytes, filename)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="469.5" x2="511.5" y1="213.6191" y2="213.6191"/><line style="stroke:#A80036;stroke-width:1.0;" x1="511.5" x2="511.5" y1="213.6191" y2="226.6191"/><line style="stroke:#A80036;stroke-width:1.0;" x1="470.5" x2="511.5" y1="226.6191" y2="226.6191"/><polygon fill="#A80036" points="480.5,222.6191,470.5,226.6191,480.5,230.6191,476.5,226.6191" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="476.5" y="208.877">Extract text from PDF</text><polygon fill="#A80036" points="625.5,251.9297,635.5,255.9297,625.5,259.9297,629.5,255.9297" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="469.5" x2="631.5" y1="255.9297" y2="255.9297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="476.5" y="251.1875">Create Document entity</text><line style="stroke:#A80036;stroke-width:1.0;" x1="647.5" x2="689.5" y1="285.2402" y2="285.2402"/><line style="stroke:#A80036;stroke-width:1.0;" x1="689.5" x2="689.5" y1="285.2402" y2="298.2402"/><line style="stroke:#A80036;stroke-width:1.0;" x1="648.5" x2="689.5" y1="298.2402" y2="298.2402"/><polygon fill="#A80036" points="658.5,294.2402,648.5,298.2402,658.5,302.2402,654.5,298.2402" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="654.5" y="280.498">Validate content</text><polygon fill="#A80036" points="480.5,323.5508,470.5,327.5508,480.5,331.5508,476.5,327.5508" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="474.5" x2="641.5" y1="327.5508" y2="327.5508"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="486.5" y="322.8086">Document</text><polygon fill="#A80036" points="228.5,352.8613,218.5,356.8613,228.5,360.8613,224.5,356.8613" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="222.5" x2="463.5" y1="356.8613" y2="356.8613"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="234.5" y="352.1191">Document</text><polygon fill="#A80036" points="751.5,382.1719,761.5,386.1719,751.5,390.1719,755.5,386.1719" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="217.5" x2="757.5" y1="386.1719" y2="386.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164" x="224.5" y="381.4297">add_document(document)</text><polygon fill="#A80036" points="919,411.4824,929,415.4824,919,419.4824,923,415.4824" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="773.5" x2="925" y1="415.4824" y2="415.4824"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99" x="780.5" y="410.7402">save(document)</text><polygon fill="#A80036" points="1131,440.793,1141,444.793,1131,448.793,1135,444.793" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="941" x2="1137" y1="444.793" y2="444.793"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183" x="948" y="440.0508">split_text(document.content)</text><polygon fill="#A80036" points="952,470.1035,942,474.1035,952,478.1035,948,474.1035" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="946" x2="1147" y1="474.1035" y2="474.1035"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90" x="958" y="469.3613">List of chunks</text><line style="stroke:#A80036;stroke-width:1.0;" x1="941" x2="983" y1="503.4141" y2="503.4141"/><line style="stroke:#A80036;stroke-width:1.0;" x1="983" x2="983" y1="503.4141" y2="516.4141"/><line style="stroke:#A80036;stroke-width:1.0;" x1="942" x2="983" y1="516.4141" y2="516.4141"/><polygon fill="#A80036" points="952,512.4141,942,516.4141,952,520.4141,948,516.4141" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180" x="948" y="498.6719">Prepare metadata for chunks</text><path d="M818,531.4141 L892,531.4141 L892,538.4141 L882,548.4141 L818,548.4141 L818,531.4141 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="75.9316" style="stroke:#000000;stroke-width:2.0;" width="492" x="818" y="531.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="833" y="544.9824">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="93" x="907" y="544.0488">[For each chunk]</text><polygon fill="#A80036" points="1237.5,566.0352,1247.5,570.0352,1237.5,574.0352,1241.5,570.0352" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="941" x2="1243.5" y1="570.0352" y2="570.0352"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156" x="948" y="565.293">add(chunk, metadata, id)</text><polygon fill="#A80036" points="952,595.3457,942,599.3457,952,603.3457,948,599.3457" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="946" x2="1253.5" y1="599.3457" y2="599.3457"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="50" x="958" y="594.6035">Success</text><line style="stroke:#A80036;stroke-width:1.0;" x1="941" x2="983" y1="635.6563" y2="635.6563"/><line style="stroke:#A80036;stroke-width:1.0;" x1="983" x2="983" y1="635.6563" y2="648.6563"/><line style="stroke:#A80036;stroke-width:1.0;" x1="942" x2="983" y1="648.6563" y2="648.6563"/><polygon fill="#A80036" points="952,644.6563,942,648.6563,952,652.6563,948,648.6563" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167" x="948" y="630.9141">Cache document metadata</text><polygon fill="#A80036" points="784.5,673.9668,774.5,677.9668,784.5,681.9668,780.5,677.9668" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="778.5" x2="935" y1="677.9668" y2="677.9668"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="50" x="790.5" y="673.2246">Success</text><polygon fill="#A80036" points="228.5,703.2773,218.5,707.2773,228.5,711.2773,224.5,707.2773" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="222.5" x2="767.5" y1="707.2773" y2="707.2773"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="50" x="234.5" y="702.5352">Success</text><polygon fill="#A80036" points="34.5,732.5879,24.5,736.5879,34.5,740.5879,30.5,736.5879" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="28.5" x2="211.5" y1="736.5879" y2="736.5879"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="40.5" y="731.8457">Display success message</text><!--MD5=[bfc4c9f8e5a859ff80892359c1ddfb65]
@startuml Document Upload Sequence

title Document Upload Flow

actor User
participant "Streamlit UI" as UI
participant "DocumentLoader" as Loader
participant "Document Entity" as Doc
participant "RAG Service" as RAG
participant "ChromaDocumentRepository" as Repo
participant "Text Splitter" as Splitter
participant "ChromaDB" as Chroma

User -> UI: Upload PDF/Text file
activate UI

UI -> Loader: load_from_pdf(file_bytes, filename)
activate Loader

Loader -> Loader: Extract text from PDF
Loader -> Doc: Create Document entity
activate Doc
Doc -> Doc: Validate content
Doc - -> Loader: Document
deactivate Doc

Loader - -> UI: Document
deactivate Loader

UI -> RAG: add_document(document)
activate RAG

RAG -> Repo: save(document)
activate Repo

Repo -> Splitter: split_text(document.content)
activate Splitter
Splitter - -> Repo: List of chunks
deactivate Splitter

Repo -> Repo: Prepare metadata for chunks

loop For each chunk
    Repo -> Chroma: add(chunk, metadata, id)
    activate Chroma
    Chroma - -> Repo: Success
    deactivate Chroma
end

Repo -> Repo: Cache document metadata
Repo - -> RAG: Success
deactivate Repo

RAG - -> UI: Success
deactivate RAG

UI - -> User: Display success message
deactivate UI

@enduml

PlantUML version 1.2021.00(Sun Jan 10 18:25:05 SGT 2021)
(MIT source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: SG
--></g></svg>